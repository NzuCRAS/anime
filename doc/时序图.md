### 发送文本信息

```angular2html
用户A浏览器          前端JS         后端WebSocketServer    ChatService(MySQL)
    |                   |                  |                      |
    | 登录 -> 已有session |                  |                      |
    | 点击好友开始聊天     |                  |                      |
    |------------------->|                  |                      |
    | 打开WS连接 ws://... |                  |                      |
    |------------------->|  WebSocket握手    |                      |
    |                   |------------------>|
    |                   |    101切换成功    |
    |                   |<------------------|
    | 输入文本"你好"      |                  |                      |
    | 点击发送            |                  |                      |
    |------------------->|                  |                      |
    |    构造JSON:       |                  |                      |
    |  {type:SEND_MESSAGE}|                  |                      |
    |        WS.send()   |----------------->|
    |                   |   校验登录/好友关系  |                     |
    |                   |------------------>| 插入消息记录          |
    |                   |                  |---------------------->|
    |                   |                  |   写MySQL成功         |
    |                   |                  |<----------------------|
    |                   |  构造NEW_MESSAGE  |
    |                   |<-----------------| 广播给会话参与者(A和B)|
    |收到NEW_MESSAGE     |                  |                      |
    |在聊天窗口显示消息   |                  |                      |
```

### 上传视频并转码

```angular2html
用户浏览器       前端JS         VideoController     MinIO        转码任务(后台)  MySQL
    |             |               |                 |              |             |
    | 选择MP4文件 |               |                 |              |             |
    | 点击上传    |-------------->| multipart POST  |              |             |
    |             |               |----putObject--->|              |             |
    |             |               |<-ok, get URL----|              |             |
    |             |               | 写video表(status=PROCESSING)   |
    |             |               |------------------------------->|
    |             |               |<-------------------------------|
    |             | <---Result(SUCCESS,videoId,status=PROCESSING)--|
    | 前端显示“处理中”|                                              |
    |             |               |                 |  消费任务队列 |
    |             |               |                 |------------->| ffmpeg转码
    |             |               |                 |    分段上传至MinIO        |
    |             |               |                 |<-------------|
    |             |               |                 |              | 更新status=READY
    |             |               |                 |              |------------>MySQL
```
